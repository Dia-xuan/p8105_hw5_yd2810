p8105_hw5_yd2810
================
Yaxuan Deng
2025-11-14

``` r
library(tidyverse)
```

    ## â”€â”€ Attaching core tidyverse packages â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ tidyverse 2.0.0 â”€â”€
    ## âœ” dplyr     1.1.4     âœ” readr     2.1.5
    ## âœ” forcats   1.0.1     âœ” stringr   1.6.0
    ## âœ” ggplot2   3.5.2     âœ” tibble    3.3.0
    ## âœ” lubridate 1.9.4     âœ” tidyr     1.3.1
    ## âœ” purrr     1.2.0     
    ## â”€â”€ Conflicts â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ tidyverse_conflicts() â”€â”€
    ## âœ– dplyr::filter() masks stats::filter()
    ## âœ– dplyr::lag()    masks stats::lag()
    ## â„¹ Use the conflicted package (<http://conflicted.r-lib.org/>) to force all conflicts to become errors

``` r
library(broom)
```

## Problem 1

``` r
set.seed(1234)

share_birthday <- function(n){
  birthday <- sample.int(365,size=n,replace = TRUE)
  any(duplicated(birthday))
}

n_seq <- 2:50
n_sim <- 10000

# simulate each n and estimate probability
simulation <- 
  map_dfr(n_seq,\(n){
    tibble(
      n=n,
      prob = mean(replicate(n_sim, share_birthday(n)))
    )
  })
```

``` r
ggplot(simulation, aes(x = n, y = prob)) +
  geom_line(linewidth = 1) +
  geom_point(size = 1.2) +
  scale_y_continuous(labels = scales::percent_format(accuracy = 1)) +
  labs(x = "Group size (n)",
       y = "Probability of â‰¥2 shared birthdays") +
  theme_minimal(base_size = 12)
```

![](p8105_hw5_yd2810_files/figure-gfm/unnamed-chunk-3-1.png)<!-- -->
According to the plot, the probability of at least two people have
shared birthdays reaches 50% at around a group size of 23, and exceeds
90% at around group size 41. The curve first rises at a slower rate for
group size lower than 10, than has a tendency of increases faster as `n`
increases until the probability becomes relatively large.

## Problem 2

``` r
set.seed(4321)

n <- 30
sigma <- 5
n_sim <- 5000
mu_grid <- c(0,1:6)

sim_once <- function(mu){
  x <- rnorm(n, mean = mu, sd = sigma)
  tt <- t.test(x, mu = 0) %>% tidy()
  tibble(mu = mu,
         mu_hat = tt$estimate,
         p = tt$p.value,
         rej = tt$p.value < 0.05)
}

sim_tbl <- map_dfr(mu_grid, ~map_dfr(1:n_sim, \(.) sim_once(.x)))
```

``` r
# plot 1
power_tbl <- sim_tbl %>% 
  group_by(mu) %>% 
  summarise(power = mean(rej), .groups = "drop")

ggplot(power_tbl, aes(mu, power))+
  geom_line()+ geom_point()+
  scale_y_continuous(labels = scales::percent_format()) +
  labs(x = "True mean (Î¼)", y = "Power (Î± = 0.05)")
```

![](p8105_hw5_yd2810_files/figure-gfm/unnamed-chunk-5-1.png)<!-- -->

Power increases with the true mean Î¼ when n=30, Ïƒ=5. It is close to 0
when Î¼=0, and approximately reaches 100% by Î¼â‰¥4. Larger effects make
one-sample t-test rejects more often.

``` r
avg_tbl <- sim_tbl %>% 
  group_by(mu) %>% 
  summarise(all = mean(mu_hat),
            rej_only = mean(mu_hat[rej]),
            .groups = "drop") %>% 
  pivot_longer(-mu, names_to = "set", values_to = "avg_mu_hat")

ggplot(avg_tbl, aes(mu, avg_mu_hat, color = set)) +
  geom_line()+ geom_point()+
  labs(x = "True mean (Î¼)", y = "Average of Î¼Ì‚",
       color = NULL)
```

![](p8105_hw5_yd2810_files/figure-gfm/unnamed-chunk-6-1.png)<!-- -->

The sample average of estimated ğœ‡ across tests for which the null is
rejected is not approximately equal to the true value of ğœ‡ when power is
low. For small ğœ‡, the â€˜rej_onlyâ€™ line sits above the â€˜allâ€™ line, for
conditioning of p\<0.05 selects estimates that are farther from 0,
creating selection bias and inflating estimation of ğœ‡. As ğœ‡ grow (\>=4)
and power approaches 1, the two lines coincide.
